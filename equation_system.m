M = sym('M', [4 4]);

N = sym('N', [4 4]);

X = sym('X', [4 4]);

Y = sym('Y', [4 4]);

M
N
X
Y

Y(4,1) = 0;
Y(4,2) = 0;
Y(4,3) = 0;
Y(4,4) = 1;

X(4,1) = 0;
X(4,2) = 0;
X(4,3) = 0;
X(4,4) = 1;

M(4,1) = 0;
M(4,2) = 0;
M(4,3) = 0;
M(4,4) = 1;

N(4,1) = 0;
N(4,2) = 0;
N(4,3) = 0;
N(4,4) = 1;


N_rot = N(1:3,1:3)
iN_rot = transpose(N_rot)
N_trans = N(1:3,4)
iN = N;
iN(1:3,1:3) = iN_rot;
iN(1:3,4) = -iN_rot * N_trans;
iN
R = M*X*iN-Y;
R = [N(1,1)*(M(1,1)*X(1,1) + M(1,2)*X(2,1) + M(1,3)*X(3,1) + M(1,4)*X(4,1)) - Y(1,1) + N(1,2)*(M(1,1)*X(1,2) + M(1,2)*X(2,2) + M(1,3)*X(3,2) + M(1,4)*X(4,2)) + N(1,3)*(M(1,1)*X(1,3) + M(1,2)*X(2,3) + M(1,3)*X(3,3) + M(1,4)*X(4,3)) + N(4,1)*(M(1,1)*X(1,4) + M(1,2)*X(2,4) + M(1,3)*X(3,4) + M(1,4)*X(4,4))== 0,
    N(1,1)*(M(2,1)*X(1,1) + M(2,2)*X(2,1) + M(2,3)*X(3,1) + M(2,4)*X(4,1)) - Y(2,1) + N(1,2)*(M(2,1)*X(1,2) + M(2,2)*X(2,2) + M(2,3)*X(3,2) + M(2,4)*X(4,2)) + N(1,3)*(M(2,1)*X(1,3) + M(2,2)*X(2,3) + M(2,3)*X(3,3) + M(2,4)*X(4,3)) + N(4,1)*(M(2,1)*X(1,4) + M(2,2)*X(2,4) + M(2,3)*X(3,4) + M(2,4)*X(4,4))==0,
    N(1,1)*(M(3,1)*X(1,1) + M(3,2)*X(2,1) + M(3,3)*X(3,1) + M(3,4)*X(4,1)) - Y(3,1) + N(1,2)*(M(3,1)*X(1,2) + M(3,2)*X(2,2) + M(3,3)*X(3,2) + M(3,4)*X(4,2)) + N(1,3)*(M(3,1)*X(1,3) + M(3,2)*X(2,3) + M(3,3)*X(3,3) + M(3,4)*X(4,3)) + N(4,1)*(M(3,1)*X(1,4) + M(3,2)*X(2,4) + M(3,3)*X(3,4) + M(3,4)*X(4,4))== 0,

    N(2,1)*(M(1,1)*X(1,1) + M(1,2)*X(2,1) + M(1,3)*X(3,1) + M(1,4)*X(4,1)) - Y(1,2) + N(2,2)*(M(1,1)*X(1,2) + M(1,2)*X(2,2) + M(1,3)*X(3,2) + M(1,4)*X(4,2)) + N(2,3)*(M(1,1)*X(1,3) + M(1,2)*X(2,3) + M(1,3)*X(3,3) + M(1,4)*X(4,3)) + N(4,2)*(M(1,1)*X(1,4) + M(1,2)*X(2,4) + M(1,3)*X(3,4) + M(1,4)*X(4,4))== 0,
    N(2,1)*(M(2,1)*X(1,1) + M(2,2)*X(2,1) + M(2,3)*X(3,1) + M(2,4)*X(4,1)) - Y(2,2) + N(2,2)*(M(2,1)*X(1,2) + M(2,2)*X(2,2) + M(2,3)*X(3,2) + M(2,4)*X(4,2)) + N(2,3)*(M(2,1)*X(1,3) + M(2,2)*X(2,3) + M(2,3)*X(3,3) + M(2,4)*X(4,3)) + N(4,2)*(M(2,1)*X(1,4) + M(2,2)*X(2,4) + M(2,3)*X(3,4) + M(2,4)*X(4,4))== 0,
    N(2,1)*(M(3,1)*X(1,1) + M(3,2)*X(2,1) + M(3,3)*X(3,1) + M(3,4)*X(4,1)) - Y(3,2) + N(2,2)*(M(3,1)*X(1,2) + M(3,2)*X(2,2) + M(3,3)*X(3,2) + M(3,4)*X(4,2)) + N(2,3)*(M(3,1)*X(1,3) + M(3,2)*X(2,3) + M(3,3)*X(3,3) + M(3,4)*X(4,3)) + N(4,2)*(M(3,1)*X(1,4) + M(3,2)*X(2,4) + M(3,3)*X(3,4) + M(3,4)*X(4,4))== 0,

    N(3,1)*(M(1,1)*X(1,1) + M(1,2)*X(2,1) + M(1,3)*X(3,1) + M(1,4)*X(4,1)) - Y(1,3) + N(3,2)*(M(1,1)*X(1,2) + M(1,2)*X(2,2) + M(1,3)*X(3,2) + M(1,4)*X(4,2)) + N(3,3)*(M(1,1)*X(1,3) + M(1,2)*X(2,3) + M(1,3)*X(3,3) + M(1,4)*X(4,3)) + N(4,3)*(M(1,1)*X(1,4) + M(1,2)*X(2,4) + M(1,3)*X(3,4) + M(1,4)*X(4,4))== 0,
    N(3,1)*(M(2,1)*X(1,1) + M(2,2)*X(2,1) + M(2,3)*X(3,1) + M(2,4)*X(4,1)) - Y(2,3) + N(3,2)*(M(2,1)*X(1,2) + M(2,2)*X(2,2) + M(2,3)*X(3,2) + M(2,4)*X(4,2)) + N(3,3)*(M(2,1)*X(1,3) + M(2,2)*X(2,3) + M(2,3)*X(3,3) + M(2,4)*X(4,3)) + N(4,3)*(M(2,1)*X(1,4) + M(2,2)*X(2,4) + M(2,3)*X(3,4) + M(2,4)*X(4,4))== 0,
    N(3,1)*(M(3,1)*X(1,1) + M(3,2)*X(2,1) + M(3,3)*X(3,1) + M(3,4)*X(4,1)) - Y(3,3) + N(3,2)*(M(3,1)*X(1,2) + M(3,2)*X(2,2) + M(3,3)*X(3,2) + M(3,4)*X(4,2)) + N(3,3)*(M(3,1)*X(1,3) + M(3,2)*X(2,3) + M(3,3)*X(3,3) + M(3,4)*X(4,3)) + N(4,3)*(M(3,1)*X(1,4) + M(3,2)*X(2,4) + M(3,3)*X(3,4) + M(3,4)*X(4,4))== 0,

    N(4,4)*(M(1,1)*X(1,4) + M(1,2)*X(2,4) + M(1,3)*X(3,4) + M(1,4)*X(4,4)) - Y(1,4) - (N(1,1)*N(1,4) + N(2,1)*N(2,4) + N(3,1)*N(3,4))*(M(1,1)*X(1,1) + M(1,2)*X(2,1) + M(1,3)*X(3,1) + M(1,4)*X(4,1)) - (N(1,2)*N(1,4) + N(2,2)*N(2,4) + N(3,2)*N(3,4))*(M(1,1)*X(1,2) + M(1,2)*X(2,2) + M(1,3)*X(3,2) + M(1,4)*X(4,2)) - (N(1,3)*N(1,4) + N(2,3)*N(2,4) + N(3,3)*N(3,4))*(M(1,1)*X(1,3) + M(1,2)*X(2,3) + M(1,3)*X(3,3) + M(1,4)*X(4,3))==0,
    N(4,4)*(M(2,1)*X(1,4) + M(2,2)*X(2,4) + M(2,3)*X(3,4) + M(2,4)*X(4,4)) - Y(2,4) - (N(1,1)*N(1,4) + N(2,1)*N(2,4) + N(3,1)*N(3,4))*(M(2,1)*X(1,1) + M(2,2)*X(2,1) + M(2,3)*X(3,1) + M(2,4)*X(4,1)) - (N(1,2)*N(1,4) + N(2,2)*N(2,4) + N(3,2)*N(3,4))*(M(2,1)*X(1,2) + M(2,2)*X(2,2) + M(2,3)*X(3,2) + M(2,4)*X(4,2)) - (N(1,3)*N(1,4) + N(2,3)*N(2,4) + N(3,3)*N(3,4))*(M(2,1)*X(1,3) + M(2,2)*X(2,3) + M(2,3)*X(3,3) + M(2,4)*X(4,3))==0,
    N(4,4)*(M(3,1)*X(1,4) + M(3,2)*X(2,4) + M(3,3)*X(3,4) + M(3,4)*X(4,4)) - Y(3,4) - (N(1,1)*N(1,4) + N(2,1)*N(2,4) + N(3,1)*N(3,4))*(M(3,1)*X(1,1) + M(3,2)*X(2,1) + M(3,3)*X(3,1) + M(3,4)*X(4,1)) - (N(1,2)*N(1,4) + N(2,2)*N(2,4) + N(3,2)*N(3,4))*(M(3,1)*X(1,2) + M(3,2)*X(2,2) + M(3,3)*X(3,2) + M(3,4)*X(4,2)) - (N(1,3)*N(1,4) + N(2,3)*N(2,4) + N(3,3)*N(3,4))*(M(3,1)*X(1,3) + M(3,2)*X(2,3) + M(3,3)*X(3,3) + M(3,4)*X(4,3))==0]
 
 

%A = sym('A', [12 24]);
b = sym('b', [24 1]);
vars = [X(1,1),X(1,2),X(1,3),X(1,4),X(2,1),X(2,2),X(2,3),X(2,4),X(3,1),X(3,2),X(3,3),X(3,4),Y(1,1),Y(1,2),Y(1,3),Y(1,4),Y(2,1),Y(2,2),Y(2,3),Y(2,4),Y(3,1),Y(3,2),Y(3,3),Y(3,4)];
[A,b] = equationsToMatrix(R,vars);
A
b

